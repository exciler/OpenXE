var o="",d=0,n=null,r=null,l=null,f=null,s=null,u=null,t=null;$(document).ready(function(){r=$("#voucherbutton"),l=$("#voucherdialog"),f=$("#posaddvoucher"),s=$("#voucherposdialog"),u=$("#voucherposfinsavesplitdialog"),t=$("#voucherposfinsavedialog"),r.length>0&&l.length>0&&r.on("click",function(){l.dialog("open")}),s.length>0&&f.length>0&&$("#posaddvoucher + label").on("click",function(){$("#posvoucher").val(""),s.dialog("open")}),$("#posvoucher").length>0&&$("#posvoucher").on("keypress",function(e){e.which==13&&(l.dialog("close"),a())}),s.length>0&&s.dialog({modal:!0,autoOpen:!1,minWidth:750,title:"Gutschein einlösen",buttons:{EINLÖSEN:function(){a(),s.dialog("close")},ABBRECHEN:function(){s.dialog("close")}},close:function(e,i){}}),l.length>0&&l.dialog({modal:!0,autoOpen:!1,minWidth:1080,title:"Gutschein",buttons:{ABBRECHEN:function(){l.dialog("close")}},close:function(e,i){}}),u.length>0&&u.dialog({modal:!0,autoOpen:!1,minWidth:750,title:"Gutschein einlösen",buttons:{HINZUFÜGEN:function(){addarticle(n),u.dialog("close"),finsale_click(),o="",n=null},"OHNE GUTSCHEIN FORTSETZEN":function(){u.dialog("close"),finsale_click(),o="",n=null}},close:function(e,i){}}),t.length>0&&t.dialog({modal:!0,autoOpen:!1,minWidth:750,title:"Gutschein einlösen",buttons:{HINZUFÜGEN:function(){addarticle(n),finsale_click(),o="",n=null,t.dialog("close")},"OHNE GUTSCHEIN FORTSETZEN":function(){finsale_click(),o="",n=null,t.dialog("close")}},close:function(e,i){}})});function v(){var e=getPositions();return e.length===0||$.each(e,function(i,c){if(c.id==d)return!0}),!1}function h(e){n=e.add,e.alluseable==1?($("#voucherposfinsavesPossible").html(e.useable+" "+e.currency),t.dialog("open")):($("#voucherposfinsavesplitPossible").html(e.useable+" "+e.currency),$("#voucherposfinsavesplitOrig").html(e.voucher_residual_value+" "+e.currency),u.dialog("open"))}function p(){o!=""&&!v()?$.ajax({url:"index.php?module=voucher&action=pos&cmd=checkvouchercode",type:"POST",dataType:"json",data:{voucher_code:o,positions:JSON.stringify(getPositions()),gross:brutto},success:function(e){if(typeof e.status<"u"&&e.status==1&&typeof e.add<"u"&&typeof e.add.id<"u"){h(e);return}finsale_click(),o="",n=null}}):(finsale_click(),o="",n=null)}function a(){var e=$("#posvoucher").val();e+""!=""&&(o="",$.ajax({url:"index.php?module=voucher&action=pos&cmd=checkvouchercode",type:"POST",dataType:"json",data:{voucher_code:e,positions:JSON.stringify(getPositions()),gross:brutto},success:function(i){if(typeof i.status<"u")if(i.status==1){o=i.voucher_code,d=i.article_id;var c=$("#finsale");c.off("click"),c.click(function(){p()}),i.tax_name,i.voucher_residual_value,typeof i.alluseable<"u"&&i.alluseable==1&&typeof i.add<"u"&&(typeof i.add.id<"u"?addarticle(i.add):alert("Der Gutschein hat keine Artikelzuordnung"))}else typeof i.error<"u"?alert(i.error):(window.console.log(i),alert("Es ist ein Fehler aufgetreten"));else alert("Es ist ein Fehler aufgetreten")}}))}
