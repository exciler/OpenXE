var f=function(o){var e={isInitialized:!1,template:{dialog:`<div id="{dialog_id}" style="display:none;" title="{dialog_title}">
	<form method="post">
		<div>
			<fieldset>
				<table class="input-control-pane" width="100%">
				</table>
			</fieldset>
		</div>
	</form>
</div>`,inputField:`<tr><td><label for="{id}">{label}:</label></td>
<td><input type="text" name="{varname}" id="{id}" width="80%"></td>
</tr>`,selectField:`<tr><td><label for="{id}">{label}:</label></td>
<td><select type="text" name="{varname}" id="{id}" width="80%">{options}</select></td>
</tr>`,selectOption:'<option value="{optvalue}">{optdisplay}</option>'},selector:{dialog:"",inputPanel:""},url:{ajaxGetInputParams:"index.php?module=report&action=list&cmd=ajaxGetInputParameters",ajaxDownload:"index.php?module=report&action=download"},storage:{$dialog:null,$fieldSet:null,formId:0,fields:{},submitButtonText:""},createDialog:function(t,a=e.onClose,i="Parameter",n="OK"){var r=t+"-parameter-input-dialog";if(e.selector.dialog="#"+r,o(e.selector.dialog).length===0){var l=(e.template.dialog+"").replace("{dialog_id}",r).replace("{dialog_title}",i);o("body").append(l)}if(typeof a!="function")throw"function onClose required for parameter dialog";if(e.onClose=a,e.selector.inputPanel=e.selector.dialog+" .input-control-pane",e.storage.submitButtonText=n,o(e.selector.dialog).length===0)throw"Dialog markup does not exitst";e.storage.$dialog=o(e.selector.dialog),e.storage.$fieldSet=o(e.selector.inputPanel),e.dialogInit(n)},dialogInit:function(t){e.storage.$dialog.dialog({modal:!0,bgiframe:!0,closeOnEscape:!1,minWidth:800,minHeight:120,maxHeight:700,autoOpen:!1,buttons:[{text:"ABBRECHEN",click:function(){e.dialogClose()}},{text:t,click:function(){e.dialogCommit()}}],open:function(){},close:function(){}})},open:function(t=0,a,i=e.onClose,n="Parameter",r="OK"){e.createDialog(a,i,n,r),e.storage.formId=t,o.ajax({url:e.url.ajaxGetInputParams,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(l){e.dialogInitFields(l.params),e.storage.fields===null||o.isEmptyObject(e.storage.fields)?e.onClose(null,"skip"):e.storage.$dialog.dialog("open")},error:function(l,s,d){console.log(s+" "+d+": "+l.responseText)},complete:function(){App.loading.close()}})},dialogInitFields:function(t){e.dialogReset(),t.forEach(e.addInputField)},addInputField:function(t,a,i){if(t.editable===!0){var n=t.varname,r="inputParam"+t.varname,l=t.displayname;(l===null||l==="")&&(l=t.varname.toString().toUpperCase()),e.storage.fields[n]=r;var s="";if(t.options.length>0&&t.control_type==="combobox"){for(var d="",u=0;u<t.options.length;u++){var c=Object.keys(t.options[u])[0],p=t.options[u][c],g=(e.template.selectOption+"").replace("{optvalue}",p).replace("{optdisplay}",c);d+=g}s=(e.template.selectField+"").replace(new RegExp("\\{id\\}","g"),r).replace("{varname}",t.varname).replace("{label}",l).replace("{options}",d),e.storage.$fieldSet.append(s)}(t.control_type===""||t.control_type==="text")&&(s=(e.template.inputField+"").replace(new RegExp("\\{id\\}","g"),r).replace("{varname}",t.varname).replace("{label}",l),e.storage.$fieldSet.append(s)),t.control_type==="date"&&(s=(e.template.inputField+"").replace(new RegExp("\\{id\\}","g"),r).replace("{varname}",t.varname).replace("{label}",l),e.storage.$fieldSet.append(s),o("#"+r).datepicker({dateFormat:"yy-mm-dd",dayNamesMin:["SO","MO","DI","MI","DO","FR","SA"],firstDay:1,showWeek:!0,monthNames:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]})),t.control_type==="autocomplete_project"&&e.createAutoComplete(n,l,r,"index.php?module=ajax&action=filter&filtername=projektname"),t.control_type==="autocomplete_group"&&e.createAutoComplete(n,l,r,"index.php?module=ajax&action=filter&filtername=gruppe"),t.control_type==="autocomplete_address"&&e.createAutoComplete(n,l,r,"index.php?module=ajax&action=filter&filtername=adresse"),t.control_type==="autocomplete_article"&&e.createAutoComplete(n,l,r,"index.php?module=ajax&action=filter&filtername=artikelnummer")}},createAutoComplete:function(t,a,i,n){var r=(e.template.inputField+"").replace(new RegExp("\\{id\\}","g"),i).replace("{varname}",t).replace("{label}",a);e.storage.$fieldSet.append(r);var l=o("#"+i);l.autocomplete({source:n,select:function(s,d){var u=l.val()+d.item.value,c=u.indexOf(",");if(u.slice(0,c),c<=0)l.val(d.item.value);else{var p=l.val(),g=p.lastIndexOf(","),v=p.substring(0,g);l.val(v+","+d.item.value)}return!1}})},dialogClose:function(){e.storage.$dialog.dialog("close")},dialogReset:function(){e.storage.fields={},e.storage.$fieldSet.empty()},dialogCommit:function(t="commit"){e.onClose(e.getDialogData(),t),e.dialogClose()},onClose:function(t,a){console.log("no action defined")},getDialogData:function(){var t={id:e.storage.formId};for(var a in e.storage.fields){var i=o("#"+e.storage.fields[a]).val();i!==null&&i!==""&&(t[a]=i)}return t}};return{open:e.open,onClose:e.onClose}}(jQuery),m=function(o){var e={isInitialized:!1,selector:{keyElement:"#report_list_main",tileView:"#reportTileView",filterButton:"#reportListFilterApply",filterCategory:"#reportListFilterCategory",filterCategorySelect:"#reportListFilterCategory > ul.ui-autocomplete",filterOwn:"#report-list-filter-own",filterFavorites:"#report-list-filter-favorites",filterTerm:"#reportListFilterTerm"},url:{ajaxGetTiles:"index.php?module=report&action=list&cmd=ajaxTiles"},init:function(){e.isInitialized!==!0&&o(e.selector.keyElement).length!==0&&(e.registerEvents(),e.isInitialized=!0)},registerEvents:function(){o(e.selector.filterButton).on("click",function(t){t.preventDefault(),e.reloadTiles()}),o(e.selector.filterCategory).on("blur",function(t){e.reloadTiles()}),o(e.selector.filterOwn).on("change",function(t){e.reloadTiles()}),o(e.selector.filterFavorites).on("change",function(t){e.reloadTiles()})},getFilterSettings:function(){return{filter_category:o(e.selector.filterCategory).val(),filter_term:o(e.selector.filterTerm).val(),filter_own:o(e.selector.filterOwn).prop("checked"),filter_favorites:o(e.selector.filterFavorites).prop("checked")}},reloadTiles:function(){console.log("filter: ",e.getFilterSettings());var t=o(e.selector.tileView);if(t.length!==0){var a=t.parent();o.ajax({url:e.url.ajaxGetTiles,method:"post",data:e.getFilterSettings(),dataType:"json",success:function(i){t.remove(),a.append(i.html)},error:function(i,n,r){console.log(n+" "+r+": "+i.responseText)}})}}};return{init:e.init,reload:e.reloadTiles}}(jQuery),h=function(o){var e={isInitialized:!1,selector:{downloadButtons:".report .download-csv-button.active",tile:".report .tile-body"},init:function(){if(e.isInitialized!==!0){if(typeof f.open!="function")throw"ReportParameterInputDialog required";e.registerEvents(),e.isInitialized=!0}},registerEvents:function(){o(document).on("click",e.selector.downloadButtons,function(t){t.preventDefault();var a=o(t.currentTarget).data("report-id"),i=o(t.currentTarget).data("format"),n=function(r,l){var s="index.php?module=report&action=download&id="+a+"&format="+i;if(r!==null){var d=o.param(r);s=s+"&"+d}window.location.href=s};f.open(a,"report-list",n,"Parameter","DOWNLOAD")})}};return{init:e.init}}(jQuery),x=function(o){var e={isInitialized:!1,selector:{allCopyButtons:"a.table-button-copy",allDeleteButtons:"a.table-button-delete",allChartButtons:"a.chart-button",dataTable:"#report_list"},url:{ajaxCopyReport:"index.php?module=report&action=create&cmd=ajaxCopyReport",ajaxDeleteReport:"index.php?module=report&action=delete&cmd=ajaxDeleteReport",ajaxGetChart:"index.php?module=report&action=list&cmd=getchart"},storage:{TileView:null},init:function(t){e.isInitialized!==!0&&(e.storage.TileView=t,e.registerEvents(),e.isInitialized=!0)},registerEvents:function(){o(document).on("click",e.selector.allCopyButtons,function(t){var a=o(t.currentTarget).data("report-id");if(a>0){var i=confirm("Bericht kopieren?");if(i===!1)return;e.ajaxCopyReport(a)}}),o(document).on("click",e.selector.allDeleteButtons,function(t){var a=o(t.currentTarget).data("report-id");if(a>0){var i=confirm("Wirklich Löschen?");if(i===!1)return;e.ajaxDeleteReport(a)}}),o(document).on("click",e.selector.allChartButtons,function(t){console.log("event fired");var a=o(t.currentTarget).data("report-id");a>0&&e.openChartReport(a)})},refreshTable:function(){o.fn.DataTable.isDataTable(e.selector.dataTable)&&o(e.selector.dataTable).DataTable().ajax.reload(),o(e.selector.tileView!==null)&&e.storage.TileView.reload()},ajaxCopyReport:function(t=0){o.ajax({url:e.url.ajaxCopyReport,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(a){e.refreshTable()},error:function(a,i,n){a.status===401?alert("Ihnen fehlt die Berechtigung."):(console.log(i,n,a.responseText),alert("Fehler beim Kopieren."))},complete:function(){App.loading.close()}})},ajaxDeleteReport:function(t=0){o.ajax({url:e.url.ajaxDeleteReport,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(a){e.refreshTable()},error:function(a,i,n){a.status===403?alert("Dieser Bericht ist schreibgeschützt."):a.status===401?alert("Ihnen fehlt die Berechtigung."):console.log(i+" "+n+": "+a.responseText)},complete:function(){App.loading.close()}})},openChartReport:function(t=0){o.ajax({url:e.url.ajaxGetChart,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(a){typeof a.html<"u"&&(o("#dialogReportChartContent").html(a.html),ChartHelper.initChart(o("#dialogReportChartContent div.chart-wrapper").first()),o("#dialogReportChart").dialog({modal:!0,autoOpen:!0,minWidth:940,title:"",buttons:{OK:function(){o(this).dialog("close")}},close:function(i,n){}}))},error:function(a,i,n){a.status===403?alert("Dieser Bericht ist schreibgeschützt."):console.log(i+" "+n+": "+a.responseText)},complete:function(){App.loading.close()}})}};return{init:e.init,reloadTiles:e.reloadTiles}}(jQuery),b=function(o){var e={isInitialized:!1,selector:{allFavoriteIcons:".svg-favorite"},url:{ajaxSetFavorite:"index.php?module=report&action=list&cmd=ajaxSetFavorite",ajaxGetFavorite:"index.php?module=report&action=list&cmd=ajaxGetFavorite"},init:function(){e.isInitialized!==!0&&(e.registerEvents(),e.isInitialized=!0)},registerEvents:function(){o(document).on("click",e.selector.allFavoriteIcons,function(t){t.preventDefault(),o(t.currentTarget).data("id"),parseInt(o(t.currentTarget).data("favorite")),e.switchFavoriteIcon(o(t.currentTarget))})},switchFavoriteIcon:function(t){var a=t.data("id"),i=parseInt(t.data("favorite"))===1;o.ajax({url:e.url.ajaxSetFavorite,method:"post",data:{id:a,set_favorite:!i},dataType:"json",success:function(n){n.is_favorite===!0?(t.addClass("favorite-on"),t.data("favorite",1)):(t.removeClass("favorite-on"),t.data("favorite",0))},error:function(n,r,l){console.log(r+" "+l+": "+n.responseText)}})}};return{init:e.init,reload:e.reloadTiles}}(jQuery);$(document).ready(function(){m.init(),x.init(m),b.init(),h.init()});var y=function(o){var e={isInitialized:!1,url:{ajaxRunSql:"index.php?module=report&action=edit&cmd=ajaxTryQuery"},selector:{resultTextBox:"#reportEditResult",queryTextBox:"#reportEditQuery",runDebugButton:"#structureRun",paramViewElement:".parameter-view"},init:function(){e.isInitialized!==!0&&(e.registerEvents(),e.isInitialized=!0)},registerEvents:function(){o(e.selector.runDebugButton).on("click",function(t){t.preventDefault(),e.ajaxDebugRequest()})},showDebugMessage:function(t,a=!1){var i=o(e.selector.resultTextBox);a===!0?i.attr("error","true"):i.attr("error","false"),i.text(t)},ajaxDebugRequest:function(){var t={};o(e.selector.paramViewElement).each(function(i,n){t[o(n).data("key")]=o(n).data("value")});var a=o(e.selector.queryTextBox).val();o.ajax({url:e.url.ajaxRunSql,data:{statement:a,parameters:t},dataType:"json",method:"post",beforeSend:function(){App.loading.open()},success:function(i){if(App.loading.close(),i.messagetype==="error"?e.showDebugMessage(i.message,!0):e.showDebugMessage(i.message),i.error)throw"request error: "+i.error}})}};return{init:e.init}}(jQuery),C=function(o){var e={isInitialized:!1,selector:{columnDialog:"#editColumnDialog",dialogMessageBox:"#editColMessage",inputFormId:"#reportEditId",inputId:"#editColId",inputKey:"#editColKey",inputTitle:"#editColTitle",inputWidth:"#editColWidth",inputAlign:"#editColAlignment",inputSort:"#editColSort",inputFormat:"#edit-col-format",inputFormatStatement:"#edit-col-format-statement",inputFormatRow:"#edit-col-format-statement-row",inputSum:"#chkColSum",inputSequence:"#editColSequence",buttonAddColumn:"#btnAddColumn",buttonAutoCreate:"#btnAutoCreateColumns",buttonDeleteAll:"#btnDeleteAllColumns",allColumnViews:"a.table-button-col-edit",allColumnDelete:"a.table-button-col-delete",dataTable:"#report_columns",resultTextBox:"#reportEditResult",queryTextBox:"#reportEditQuery"},url:{ajaxGetColumn:"index.php?module=report&action=edit&cmd=ajaxGetColumn",ajaxSaveColumn:"index.php?module=report&action=edit&cmd=ajaxSaveColumn",ajaxDeleteColumn:"index.php?module=report&action=edit&cmd=ajaxDeleteColumn",ajaxDeleteAllColumns:"index.php?module=report&action=edit&cmd=ajaxDeleteColumn",ajaxAutoCreateColumns:"index.php?module=report&action=edit&cmd=ajaxAutoCreateColumns"},storage:{$dialog:null,formId:0},init:function(){e.isInitialized!==!0&&(e.storage.$dialog=o(e.selector.columnDialog),e.storage.formId=o(e.selector.inputFormId).data("form-id"),e.dialogInit(),e.registerEvents(),e.isInitialized=!0)},dialogInit:function(){e.storage.$dialog.dialog({modal:!0,bgiframe:!0,closeOnEscape:!1,minWidth:500,minHeight:320,maxHeight:700,autoOpen:!1,buttons:[{text:"ABBRECHEN",click:function(){e.dialogClose()}},{text:"SPEICHERN",click:function(){e.dialogSave()}}],open:function(){o(e.selector.inputKey).trigger("focus")},close:function(){}})},dialogOpen:function(t=0){if(e.storage.formId<1&&t<1){alert("Bitte speichern Sie zuerst den Bericht.");return}if(t<1){e.dialogReset(),e.storage.$dialog.dialog("open");return}o.ajax({url:e.url.ajaxGetColumn,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(a){e.dialogReset(),e.setDialogData(a),App.loading.close(),e.storage.$dialog.dialog("open")}})},dialogClose:function(){e.storage.$dialog.dialog("close")},dialogReset:function(){e.dialogSetMessage(""),e.setDialogData(null)},dialogSave:function(){e.ajaxSaveColumn(e.getDialogData())},dialogDelete:function(){var t=e.storage.$dialog.find(e.selector.inputId).val();e.ajaxDeleteColumn(t)},dialogSetMessage:function(t){e.storage.$dialog.find(e.selector.dialogMessageBox).text(t)},getDialogData:function(){return{reportId:e.storage.formId,id:e.storage.$dialog.find(e.selector.inputId).val(),key_name:e.storage.$dialog.find(e.selector.inputKey).val(),title:e.storage.$dialog.find(e.selector.inputTitle).val(),width:e.storage.$dialog.find(e.selector.inputWidth).val(),alignment:e.storage.$dialog.find(e.selector.inputAlign).val(),sorting:e.storage.$dialog.find(e.selector.inputSort).val(),format_type:e.storage.$dialog.find(e.selector.inputFormat).val(),format_statement:e.storage.$dialog.find(e.selector.inputFormatStatement).val(),sum:e.storage.$dialog.find(e.selector.inputSum).prop("checked")===!0?1:0,sequence:e.storage.$dialog.find(e.selector.inputSequence).val()}},setDialogData:function(t){t==null&&(t={}),e.storage.$dialog.find(e.selector.inputId).val("id"in t?t.id:""),e.storage.$dialog.find(e.selector.inputKey).val("key_name"in t?t.key_name:""),e.storage.$dialog.find(e.selector.inputTitle).val("title"in t?t.title:""),e.storage.$dialog.find(e.selector.inputWidth).val("width"in t?t.width:""),e.storage.$dialog.find(e.selector.inputAlign).val("alignment"in t&&t.alignment!==""?t.alignment:"left"),e.storage.$dialog.find(e.selector.inputSort).val("sorting"in t&&t.sorting!==""?t.sorting:"numeric"),e.storage.$dialog.find(e.selector.inputFormat).val("format_type"in t?t.format_type:null),e.storage.$dialog.find(e.selector.inputFormatStatement).val("format_statement"in t?t.format_statement:null),e.storage.$dialog.find(e.selector.inputSum).prop("checked","sum"in t?t.sum:!1),e.storage.$dialog.find(e.selector.inputSequence).val("sequence"in t?t.sequence:""),e.toggleReportStatementField()},registerEvents:function(){o(e.selector.buttonAddColumn).on("click",function(t){t.preventDefault(),e.dialogOpen(0)}),o(e.selector.buttonAutoCreate).on("click",function(t){t.preventDefault(),e.autoCreateColumns()}),o(e.selector.buttonDeleteAll).on("click",function(t){t.preventDefault();var a=confirm("Wirklich alle Spalten Löschen?");a!==!1&&e.ajaxDeleteColumn(0,!0)}),o(e.selector.inputFormat).on("change",function(t){e.toggleReportStatementField()}),o(document).on("click",e.selector.allColumnViews,function(t){var a=o(t.currentTarget).data("column-id");e.dialogOpen(a)}),o(document).on("click",e.selector.allColumnDelete,function(t){var a=o(t.currentTarget).data("column-id");if(a>0){var i=confirm("Wirklich Löschen?");if(i===!1)return;e.ajaxDeleteColumn(a)}})},tableRefresh:function(){o.fn.DataTable.isDataTable(e.selector.dataTable)&&o(e.selector.dataTable).DataTable().ajax.reload()},ajaxSaveColumn:function(t){o.ajax({url:e.url.ajaxSaveColumn,data:t,dataType:"json",method:"post",beforeSend:function(){App.loading.open()},success:function(a){e.dialogClose(),e.tableRefresh()},error:function(a,i,n){console.log(i+" "+n+": "+a.responseText),e.dialogSetMessage(a.responseText)},complete:function(){App.loading.close()}})},ajaxDeleteColumn:function(t,a=!1){o.ajax({url:e.url.ajaxDeleteColumn,data:{id:t,delete_all:a,report_id:e.storage.formId},dataType:"json",method:"post",beforeSend:function(){App.loading.open()},success:function(i){e.tableRefresh()},error:function(i,n,r){console.log(n+" "+r+": "+i.responseText)},complete:function(){App.loading.close()}})},toggleReportStatementField:function(){var t=e.storage.$dialog.find(e.selector.inputFormat).val();t==="custom"?e.storage.$dialog.find(e.selector.inputFormatRow).removeClass("report-edit-inactive").addClass("report-edit-active"):e.storage.$dialog.find(e.selector.inputFormatRow).removeClass("report-edit-active").addClass("report-edit-inactive")},autoCreateColumns:function(){if(e.storage.formId<1){alert("Bitte speichern Sie zuerst den Bericht.");return}o.ajax({url:e.url.ajaxAutoCreateColumns,data:{id:e.storage.formId},dataType:"json",method:"post",beforeSend:function(){App.loading.open()},success:function(t){console.log("response",t),t.success===!0?e.tableRefresh():alert(t.message)},error:function(t,a,i){console.log(a+" "+i+": "+t.responseText)},complete:function(){App.loading.close()}})}};return{init:e.init}}(jQuery),j=function(o){var e={isInitialized:!1,storage:{$dialog:null,formId:0},url:{ajaxGetParam:"index.php?module=report&action=edit&cmd=ajaxGetParam",ajaxSaveParam:"index.php?module=report&action=edit&cmd=ajaxSaveParam",ajaxDeleteParam:"index.php?module=report&action=edit&cmd=ajaxDeleteParam"},selector:{dialog:"#editParamDialog",dialogMessageBox:"#editParamMessage",inputReportId:"#reportEditId",inputId:"#editParamId",inputVarname:"#editParamVarname",inputValue:"#editParamValue",inputLabel:"#editParamLabel",inputDescription:"#editParamDescription",inputOptions:"#editParamOptions",inputControl:"#editParamControl",inputEditable:"#chkParamEditable",buttonAddParameter:"#btnAddParam",allParamViews:"#paramListing > .parameter-view",paramsView:"#paramListing"},template:{paramView:'<div class="parameter-view" data-id="{id}" data-key="{varname}" data-value="{value}">{varname}={value}</div>'},init:function(){e.isInitialized!==!0&&(e.storage.formId=o(e.selector.inputReportId).data("form-id"),e.storage.$dialog=o(e.selector.dialog),e.dialogInit(),e.registerEvents(),e.isInitialized=!0)},dialogInit:function(){e.storage.$dialog.dialog({modal:!0,bgiframe:!0,closeOnEscape:!1,minWidth:500,minHeight:420,maxHeight:700,autoOpen:!1,buttons:[{text:"LÖSCHEN",click:function(){e.dialogDelete(),e.dialogClose()}},{text:"ABBRECHEN",click:function(){e.dialogClose()}},{text:"SPEICHERN",click:function(){e.dialogSave()}}],open:function(){o(e.selector.inputVarname).trigger("focus")},close:function(){}})},dialogOpen:function(t=0){if(e.storage.formId<1&&t<1){alert("Bitte speichern Sie zuerst den Bericht.");return}if(t<1){e.dialogReset(),e.storage.$dialog.dialog("open");return}o.ajax({url:e.url.ajaxGetParam,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(a){e.dialogReset(),e.setDialogData(a),App.loading.close(),e.storage.$dialog.dialog("open")}})},dialogClose:function(){e.storage.$dialog.dialog("close")},dialogReset:function(){e.dialogSetMessage(""),e.setDialogData(null)},dialogSave:function(){var t=e.storage.$dialog.find(e.selector.inputVarname).val().toUpperCase();e.storage.$dialog.find(e.selector.inputVarname).val(t),e.ajaxSaveParam(e.getDialogData())},dialogDelete:function(){var t=confirm("Wirklich Löschen?");if(t!==!1){var a=e.storage.$dialog.find("#editParamId").val();e.ajaxDeleteParam(a)}},dialogSetMessage:function(t=""){e.storage.$dialog.find(e.selector.dialogMessageBox).text(t)},getDialogData:function(){return{reportId:e.storage.formId,paramId:e.storage.$dialog.find(e.selector.inputId).val(),varname:e.storage.$dialog.find(e.selector.inputVarname).val(),value:e.storage.$dialog.find(e.selector.inputValue).val(),label:e.storage.$dialog.find(e.selector.inputLabel).val(),description:e.storage.$dialog.find(e.selector.inputDescription).val(),options:e.storage.$dialog.find(e.selector.inputOptions).val(),control_type:e.storage.$dialog.find(e.selector.inputControl).val(),editable:e.storage.$dialog.find(e.selector.inputEditable).prop("checked")===!0?1:0}},setDialogData:function(t){t==null&&(t={}),e.storage.$dialog.find(e.selector.inputId).val("id"in t?t.id:""),e.storage.$dialog.find(e.selector.inputVarname).val("varname"in t?t.varname:""),e.storage.$dialog.find(e.selector.inputValue).val("default_value"in t?t.default_value:""),e.storage.$dialog.find(e.selector.inputLabel).val("displayname"in t?t.displayname:""),e.storage.$dialog.find(e.selector.inputDescription).val("description"in t?t.description:""),e.storage.$dialog.find(e.selector.inputOptions).val("options"in t?t.options:""),e.storage.$dialog.find(e.selector.inputControl).val("control_type"in t&&t.control_type!==""?t.control_type:"text"),e.storage.$dialog.find(e.selector.inputEditable).prop("checked","editable"in t?t.editable:!1)},registerEvents:function(){o(e.selector.buttonAddParameter).on("click",function(t){t.preventDefault(),e.dialogOpen()}),o(document).on("click",e.selector.allParamViews,function(t){var a=o(t.target).data("id");e.dialogOpen(a)})},updateParameterView:function(t,a,i){var n=o(e.selector.paramsView),r=n.find('div[data-id="'+i+'"]');if(r===null||r.length===0){var l=(e.template.paramView+"").replace("{id}",i).replace(new RegExp("\\{varname\\}","g"),t).replace(new RegExp("\\{value\\}","g"),a);n.append(l)}else r.text(t+"="+a),r.attr("data-key",t),r.attr("data-value",a)},removeParameterView:function(t){o(e.selector.paramsView+' > div[data-id="'+t+'"]').remove()},ajaxSaveParam:function(t){o.ajax({url:e.url.ajaxSaveParam,data:t,dataType:"json",method:"post",beforeSend:function(){App.loading.open()},success:function(a){e.updateParameterView(t.varname,t.value,a.id),e.dialogClose()},error:function(a,i,n){console.log(i+" "+n+": "+a.responseText),e.dialogSetMessage(a.responseText)},complete:function(){App.loading.close()}})},ajaxDeleteParam:function(t){o.ajax({url:e.url.ajaxDeleteParam,data:{id:t},dataType:"json",method:"post",beforeSend:function(){App.loading.open()},success:function(a){e.removeParameterView(t)},error:function(a,i,n){console.log(i+" "+n+": "+a.responseText)},complete:function(){App.loading.close()}})}};return{init:e.init}}(jQuery),D=function(o){var e={isInitialized:!1,storage:{initQuery:"",$queryBox:null,$hint:null},selector:{queryTextBox:"#reportEditQuery",runDebugButton:"#structureRun",dirtyHint:"#dirtyWarning"},init:function(){e.isInitialized!==!0&&(e.storage.$queryBox=o(e.selector.queryTextBox),e.storage.$hint=o(e.selector.dirtyHint),e.storage.initQuery=e.storage.$queryBox.val(),e.registerEvents(),e.isInitialized=!0)},registerEvents:function(){o(e.selector.queryTextBox).on("input propertychange",function(t){e.updateHighlight()})},updateHighlight:function(){e.storage.$queryBox.val()!==e.storage.initQuery?(e.storage.$queryBox.attr("dirty","true"),e.storage.$hint.attr("dirty","true")):(e.storage.$queryBox.attr("dirty","false"),e.storage.$hint.attr("dirty","false"))}};return{init:e.init}}(jQuery);$(document).ready(function(){$("#report_edit_form").length!==0&&(C.init(),y.init(),j.init(),D.init())});var I=function(o){var e={isInitialized:!1,selector:{dialog:"#editSharingDialog",dataTable:"#report_shareduser",dialogMessage:"#dialogMessage",addUserButton:"#shareUserAddBtn",editUserButton:"a.table-button-edit",deleteUserButton:"a.table-button-delete",pageInputUser:"#sharedUserFind",inputUser:"#inputDialogUser",inputUserId:"#inputDialogUserId",inputReportId:"#inputDialogReportId",checkChart:"#chkDialogShareChart",checkFile:"#chkDialogShareFile",checkMenu:"#chkDialogShareMenu",checkTab:"#chkDialogShareTab"},url:{ajaxGetSharedUser:"index.php?module=report&action=share&cmd=ajaxGetShareUser",ajaxSaveSharedUser:"index.php?module=report&action=share&cmd=ajaxSaveShareUser",ajaxDeleteSharedUser:"index.php?module=report&action=share&cmd=ajaxDeleteShareUser"},storage:{$dialog:null,formId:0},init:function(){if(e.isInitialized!==!0){if(console.log("init sharing dialog"),e.storage.$dialog=o(e.selector.dialog),e.storage.$dialog.length!==1){console.log("stop init sharing dialog");return}e.dialogInit(),e.registerEvents(),e.isInitialized=!0}},dialogInit:function(){e.storage.$dialog.dialog({modal:!0,bgiframe:!0,closeOnEscape:!1,minWidth:600,maxWidth:600,minHeight:120,maxHeight:700,autoOpen:!1,buttons:[{text:"ABBRECHEN",click:function(){e.dialogClose()}},{text:"SPEICHERN",click:function(){e.dialogSave()}}],open:function(){o(e.selector.inputUser).trigger("focus")},close:function(){e.dialogReset()}})},dialogOpen:function(t=0){if(e.storage.formId=t,t>0)o.ajax({url:e.url.ajaxGetSharedUser,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(i){e.setDialogData(i),e.storage.$dialog.dialog("open")},error:function(i,n,r){console.log(n+" "+r+": "+i.responseText)},complete:function(){App.loading.close()}});else{e.dialogReset();var a=o(e.selector.pageInputUser).val();o(e.selector.inputUser).val(a),e.storage.$dialog.dialog("open")}},dialogClose:function(){e.storage.$dialog.dialog("close")},dialogReset:function(){e.setDialogData(null)},dialogSave:function(){o.ajax({url:e.url.ajaxSaveSharedUser,data:e.getDialogData(),method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(t){e.tableRefresh()},error:function(t,a,i){t.status===400?alert("Der Bericht ist für diesen Mitarbeiter schon freigegeben."):(alert("Fehler beim Speichern"),console.log(a+" "+i+": "+t.responseText))},complete:function(){App.loading.close()}}),e.dialogClose()},getDialogData:function(){return{report_id:parseInt(e.storage.$dialog.find(e.selector.inputReportId).val()),id:e.storage.formId,user_id:e.storage.$dialog.find(e.selector.inputUserId).val(),name:e.storage.$dialog.find(e.selector.inputUser).val(),chart_enabled:o(e.selector.checkChart).prop("checked")===!0?1:0,file_enabled:o(e.selector.checkFile).prop("checked")===!0?1:0,menu_enabled:o(e.selector.checkMenu).prop("checked")===!0?1:0,tab_enabled:o(e.selector.checkTab).prop("checked")===!0?1:0}},setDialogData:function(t){t==null&&(t={report_id:0,name:"",user_id:0,chart_enabled:0,file_enabled:0,menu_enabled:0,tab_enabled:0}),o(e.selector.inputUser).val(t.name),o(e.selector.inputUserId).val(t.user_id),t.name!==""?o(e.selector.inputUser).attr("disabled",!0):o(e.selector.inputUser).attr("disabled",!1),o(e.selector.checkChart).prop("checked",t.chart_enabled>0),o(e.selector.checkFile).prop("checked",t.file_enabled>0),o(e.selector.checkMenu).prop("checked",t.menu_enabled>0),o(e.selector.checkTab).prop("checked",t.tab_enabled>0)},registerEvents:function(){o(document).on("click",e.selector.deleteUserButton,function(t){var a=parseInt(o(t.currentTarget).data("id"));if(a>0){var i=confirm("Wirklich Löschen?");if(i===!1)return;e.ajaxDeleteSharedUser(a)}}),o(document).on("click",e.selector.editUserButton,function(t){var a=o(t.currentTarget).data("id");e.dialogOpen(a)}),o(e.selector.addUserButton).on("click",function(t){t.preventDefault(),e.dialogOpen(0)})},tableRefresh:function(){o.fn.DataTable.isDataTable(e.selector.dataTable)&&o(e.selector.dataTable).DataTable().ajax.reload()},ajaxDeleteSharedUser:function(t){o.ajax({url:e.url.ajaxDeleteSharedUser,data:{id:t},method:"post",dataType:"json",beforeSend:function(){App.loading.open()},success:function(){e.tableRefresh()},error:function(a,i,n){alert("Fehler beim Löschen"),console.log(i+" "+n+": "+a.responseText)},complete:function(){App.loading.close()}})}};return{init:e.init}}(jQuery);$(document).ready(function(){I.init()});var T=function(o){var e={isInitialized:!1,selector:{keyElement:"#report_transfer_form",linkTextBox:"#transferUrlAdress",buttonCopyLink:"#transferUrlClipboard"},init:function(){e.isInitialized!==!0&&o(e.selector.keyElement).length!==0&&(e.registerEvents(),e.isInitialized=!0)},registerEvents:function(){o(e.selector.buttonCopyLink).on("click",function(t){t.preventDefault(),e.copyToClipBoard(o(e.selector.linkTextBox).val())})},copyToClipBoard:function(t){var a=document.createElement("textarea");a.value=t,a.style.position="fixed",document.body.appendChild(a),a.focus(),a.select();try{var i=document.execCommand("copy")}catch{console.error("Unable to copy link to clipboard.")}document.body.removeChild(a)}};return{init:e.init}}(jQuery);$(document).ready(function(){T.init()});var S=function(o){var e={storage:{menulinks:null,menuPopup:null},openMenuPopup:function(t){o.ajax({url:"index.php?module=report&action=view&cmd=getreportpopup",type:"POST",dataType:"json",data:{report_id:t},success:function(a){typeof a.html<"u"&&(o("#reportMenuPopupContent").html(a.html),o(e.storage.menuPopup).dialog("open"))}})},init:function(){e.storage.menuPopup=o("#reportMenuPopup"),e.storage.menuPopup.length!==0&&(e.storage.menuLinks=o("ul#submenu li a.reportpopup"),e.storage.menuLinks.length!==0&&(o(e.storage.menuPopup).dialog({modal:!0,autoOpen:!1,minWidth:940,title:"",buttons:{OK:function(){o(this).dialog("close")}}}),e.storage.menuLinks.on("click",function(){e.openMenuPopup(o(this).data("reportid"))})))}};return{init:e.init}}(jQuery);$(document).on("ready",function(){S.init()});
